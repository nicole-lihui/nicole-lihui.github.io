# Basic

1. 传统page查询和cursor查询的区别
2. 保证id全局唯一， 雪花算法

## 基础知识点

## 实践
### 传统page查询和cursor查询的区别
#### 传统page查询（limit, offset）
##### 设计：
  > 通常在分页时会携带两个可选参数，limit和offset, SQL语句如下
```sql
mysql> SELECT * FROM TEST_TABLE LIMIT offset, limit;
-- Or
mysql> SELECT * FROM TEST_TABLE LIMIT limit, OFFSET offset;
```
##### 问题：
1. 当数据库数据越大，性能消耗越大（全表深度查询）
   * 例如数据库集群，5台服务器，需要查询5000条数据，数据库需要在每台服务器中查询前5000条，总共获取25000条数据，然后重新排序获取5000条。当数据库数据越庞大，性能消耗就越大。
2. 数据重复 
```
+---------------------------+
| 1 | 2 | 3 | 4 | 5 | 6 | 7 |
+---------------------------+
        || 参数：limit=3&offset=0，得到      
    +-----------+
    | 1 | 2 | 3 |
    +-----------+

        || 删除一条数据（2）

+-----------------------+
| 1 | 3 | 4 | 5 | 6 | 7 |
+-----------------------+

       || 参数：limit=3&offset=3, 得到
    +-----------+
    | 5 | 6 | 7 |
    +-----------+

期望：4，5，6
实际：5，6，7，这就导致4这条记录没有被取到
```
3. 数据丢失
```
+---------------------------+
| 1 | 2 | 3 | 4 | 5 | 6 | 7 |
+---------------------------+
        || 参数：limit=3&offset=0，得到      
    +-----------+
    | 1 | 2 | 3 |
    +-----------+

        || 插入一条数据

+-------------------------------+
| 1 | 8 | 2 | 3 | 4 | 5 | 6 | 7 |
+-------------------------------+

       || 参数：limit=3&offset=3, 得到
    +-----------+
    | 3 | 4 | 5 |
    +-----------+

期望：4，5，6，
实际：3，4，5，与第一次取出的1，2，3 重复了 3 这条数据
```

#### cursor查询
##### 设计
  > 游标分页是通过 cursor 和 size 这样的类似两个参数来控制翻页，简单的 SQL 语句如下：
```sql
mysql> select * from data where id>cursor limit size
```
这样再来看上面的两个问题，第一个参数变为 cursor=3&size=3，结果为 4，5，6，符合预期
第二个参数取出结果为 4，5，6，也符合预期。看来数据缺失和数据重复的问题得到了解决 🎉
##### 问题

##### 总结

##### 参考
[MySQL 游标分页与传统分页](https://github.com/x1ah/Blog/issues/15)